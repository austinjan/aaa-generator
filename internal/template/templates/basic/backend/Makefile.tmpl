.PHONY: dev build clean install run test

# é–‹ç™¼æ¨¡å¼
dev:
	@echo "ğŸ”„ Starting development servers..."
	@echo "Frontend will be available at: http://localhost:5173"
	@echo "Backend will be available at: http://localhost:{{.Port}}"
	@cd frontend && npm run dev &
	@sleep 2
	@go run main.go

# å®‰è£ä¾è³´
install:
	@echo "ğŸ“¦ Installing dependencies..."
	@cd frontend && npm install
	@go mod tidy

# æ§‹å»ºç”Ÿç”¢ç‰ˆæœ¬
build:
	@echo "ğŸ—ï¸  Building frontend..."
	@cd frontend && npm run build
	@echo "ğŸ—ï¸  Building backend..."
	@go build -ldflags="-s -w" -o {{.ProjectName}} main.go
	@echo "âœ… Build complete! Run ./{{.ProjectName}} to start"

# é‹è¡Œç”Ÿç”¢ç‰ˆæœ¬
run: build
	@echo "ğŸš€ Starting {{.ProjectName}}..."
	@./{{.ProjectName}}

# æ¸¬è©¦
test:
	@echo "ğŸ§ª Running tests..."
	@go test ./...
	@cd frontend && npm test

# æ¸…ç†
clean:
	@echo "ğŸ§¹ Cleaning..."
	@rm -rf frontend/dist
	@rm -f {{.ProjectName}}
	@echo "âœ… Clean complete!"

# Docker æ§‹å»º
docker-build:
	@echo "ğŸ³ Building Docker image..."
	@docker build -t {{.ProjectName}}:latest .

# Docker é‹è¡Œ
docker-run:
	@echo "ğŸ³ Running Docker container..."
	@docker run -p {{.Port}}:{{.Port}} {{.ProjectName}}:latest

# é¡¯ç¤ºå¹«åŠ©
help:
	@echo "{{.ProjectName}} - Available commands:"
	@echo "  make install     - Install dependencies"
	@echo "  make dev         - Start development servers"
	@echo "  make build       - Build for production"
	@echo "  make run         - Run production build"
	@echo "  make test        - Run tests"
	@echo "  make clean       - Clean build artifacts"
	@echo "  make docker-build - Build Docker image"
	@echo "  make docker-run  - Run Docker container"